<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guests - Ocean View Resort</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Guest Management</h1>
            <p>Manage Hotel Guests</p>
        </header>

        <nav>
            <a href="dashboard.html">Dashboard</a>
            <a href="guests.html">Guests</a>
            <a href="room-categories.html">Room Categories</a>
            <a href="rooms.html">Rooms</a>
            <a href="meals.html">Meals</a>
            <a href="reservations.html">Reservations</a>
            <a href="help.html">Help</a>
        </nav>

        <main>
            <section>
                <h2>All Guests</h2>
                <button onclick="showAddForm()" class="btn">+ Add New Guest</button>

                <div id="addForm" style="display:none; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 id="formTitle">Add New Guest</h3>
                    <form id="guestForm">
                        <input type="hidden" id="guestId">
                        <div class="form-group">
                            <label>Guest Name:</label>
                            <input type="text" id="guestName" required>
                        </div>
                        <div class="form-group">
                            <label>Address:</label>
                            <input type="text" id="address" required>
                        </div>
                        <div class="form-group">
                            <label>Contact Number:</label>
                            <input type="text" id="contactNumber" required>
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label>ID Number:</label>
                            <input type="text" id="idNumber" required>
                        </div>
                        <button type="submit" class="btn">Save Guest</button>
                        <button type="button" onclick="hideAddForm()" class="btn" style="background: #7f8c8d;">Cancel</button>
                    </form>
                    <div id="message"></div>
                </div>

                <table id="guestsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>ID Number</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="guestsList">
                        <tr>
                            <td colspan="6">Loading guests...</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>

        <footer>
            <p>&copy; 2026 Ocean View Resort. All rights reserved.</p>
        </footer>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/oceanview-resort/api';

        function showAddForm() {
            document.getElementById('formTitle').textContent = 'Add New Guest';
            document.getElementById('guestForm').reset();
            document.getElementById('guestId').value = '';
            document.getElementById('addForm').style.display = 'block';
        }

        function hideAddForm() {
            document.getElementById('addForm').style.display = 'none';
            document.getElementById('guestForm').reset();
        }

        async function loadGuests() {
            try {
                const response = await fetch(`${API_BASE}/guests/`);
                const result = await response.json();

                if (result.success && result.data) {
                    displayGuests(result.data);
                } else {
                    document.getElementById('guestsList').innerHTML = '<tr><td colspan="6">No guests found or API error</td></tr>';
                }
            } catch (error) {
                document.getElementById('guestsList').innerHTML = '<tr><td colspan="6">Error loading guests. API may not be working.</td></tr>';
            }
        }

        function displayGuests(guests) {
            const tbody = document.getElementById('guestsList');
            if (guests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No guests registered yet.</td></tr>';
                return;
            }

            tbody.innerHTML = guests.map(guest => `
                <tr>
                    <td>${guest.guestId}</td>
                    <td>${guest.guestName}</td>
                    <td>${guest.contactNumber}</td>
                    <td>${guest.email || 'N/A'}</td>
                    <td>${guest.idNumber || 'N/A'}</td>
                    <td>
                        <button onclick="editGuest(${guest.guestId})" class="btn" style="padding: 5px 10px; font-size: 12px;">Edit</button>
                        <button onclick="deleteGuest(${guest.guestId})" class="btn" style="padding: 5px 10px; font-size: 12px; background: #e74c3c;">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        document.getElementById('guestForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const guestId = document.getElementById('guestId').value;
            const guest = {
                guestName: document.getElementById('guestName').value,
                address: document.getElementById('address').value,
                contactNumber: document.getElementById('contactNumber').value,
                email: document.getElementById('email').value,
                idNumber: document.getElementById('idNumber').value
            };

            try {
                let url = `${API_BASE}/guests/`;
                let method = 'POST';

                if (guestId) {
                    guest.guestId = parseInt(guestId);
                    url = `${API_BASE}/guests/${guestId}`;
                    method = 'PUT';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(guest)
                });

                const result = await response.json();

                if (result.success) {
                    alert(guestId ? 'Guest updated successfully!' : 'Guest added successfully!');
                    hideAddForm();
                    loadGuests();
                    document.getElementById('guestForm').reset();
                } else {
                    alert('Failed to save guest: ' + result.message);
                }
            } catch (error) {
                alert('Error saving guest. API may not be working.');
            }
        });

        async function deleteGuest(id) {
            if (!confirm('Are you sure you want to delete this guest?')) return;

            try {
                const response = await fetch(`${API_BASE}/guests/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Guest deleted!');
                    loadGuests();
                } else {
                    alert('Failed to delete guest');
                }
            } catch (error) {
                alert('Error deleting guest');
            }
        }

        async function editGuest(id) {
            try {
                const response = await fetch(`${API_BASE}/guests/${id}`);
                const result = await response.json();

                if (result.success && result.data) {
                    const guest = result.data;
                    document.getElementById('formTitle').textContent = 'Edit Guest';
                    document.getElementById('guestId').value = guest.guestId;
                    document.getElementById('guestName').value = guest.guestName;
                    document.getElementById('address').value = guest.address;
                    document.getElementById('contactNumber').value = guest.contactNumber;
                    document.getElementById('email').value = guest.email || '';
                    document.getElementById('idNumber').value = guest.idNumber || '';
                    document.getElementById('addForm').style.display = 'block';
                } else {
                    alert('Failed to load guest data');
                }
            } catch (error) {
                alert('Error loading guest data');
            }
        }

        // Load guests when page loads
        loadGuests();
    </script>
</body>
</html>
