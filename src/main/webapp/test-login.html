<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login Test - Ocean View Resort</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 50px; }
        .test-section { margin: 30px 0; padding: 20px; background: #f5f5f5; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 5px; }
        .result { margin-top: 15px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        pre { background: white; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Login API Test - Debugging Tool</h1>

    <div class="test-section">
        <h2>Test 1: Admin Login</h2>
        <button onclick="testLogin('admin', 'admin123', 'result1')">Test Admin</button>
        <div id="result1"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Staff1 Login</h2>
        <button onclick="testLogin('staff1', 'staff123', 'result2')">Test Staff1</button>
        <div id="result2"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Manager Login</h2>
        <button onclick="testLogin('manager', 'manager123', 'result3')">Test Manager</button>
        <div id="result3"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Check Database Directly (JSP)</h2>
        <button onclick="testDatabase()">Test Database Connection</button>
        <div id="result4"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/oceanview-resort/api';

        async function testLogin(username, password, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = '<p>Testing login for: <strong>' + username + '</strong>...</p>';

            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const responseText = await response.text();
                console.log('Response text:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    resultDiv.innerHTML = '<div class="result error"><strong>PARSE ERROR:</strong><br>' + responseText + '</div>';
                    return;
                }

                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>✅ LOGIN SUCCESSFUL!</h3>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>❌ LOGIN FAILED</h3>
                            <p><strong>Message:</strong> ${result.message}</p>
                            <p><strong>Response Size:</strong> ${responseText.length} bytes</p>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ NETWORK ERROR</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testDatabase() {
            const resultDiv = document.getElementById('result4');
            resultDiv.innerHTML = '<p>Testing database connection...</p>';

            try {
                window.open('test-db.jsp', '_blank');
                resultDiv.innerHTML = '<div class="result success"><p>Opened test-db.jsp in new tab. Check that window!</p></div>';
            } catch (error) {
                resultDiv.innerHTML = '<div class="result error"><p>Error: ' + error.message + '</p></div>';
            }
        }

        // Auto-test admin on page load
        window.onload = function() {
            console.log('Auto-testing admin login...');
            testLogin('admin', 'admin123', 'result1');
        };
    </script>
</body>
</html>
